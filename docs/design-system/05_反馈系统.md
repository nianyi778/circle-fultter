# Aura 拾光 · 反馈系统

> 反馈是产品与用户之间的"对话"。
> 在 Aura 中，反馈应该是 **温柔的确认**，而非 **急促的提醒**。

---

## 一、反馈设计原则

### 1.1 核心理念

```
确认的    而不是 警告的
温柔的    而不是 急促的
克制的    而不是 强烈的
有意义的  而不是 冗余的
```

### 1.2 反馈时机

| 场景 | 是否反馈 | 反馈强度 |
|------|---------|---------|
| 操作成功 | ✅ 是 | 轻柔 |
| 操作失败 | ✅ 是 | 清晰但不惊吓 |
| 点击按钮 | ✅ 是 | 即时、微妙 |
| 加载完成 | ⚠️ 视情况 | 无声或极轻 |
| 后台自动操作 | ❌ 否 | 不打扰 |

### 1.3 反馈禁区

| 禁止 | 原因 |
|------|------|
| 红色警告框 | 制造焦虑 |
| 连续 Toast | 信息轰炸 |
| 声音提示 | 打断情绪（除非用户主动开启） |
| 全屏遮罩错误 | 过于严重 |
| 闪烁/抖动 | 制造紧张 |

---

## 二、触觉反馈 (Haptic)

### 2.1 反馈等级

| 等级 | iOS 对应 | Android 对应 | 用途 |
|------|---------|-------------|------|
| `light` | `lightImpact` | `tick` | 轻触、选中 |
| `medium` | `mediumImpact` | `click` | 按钮点击、开关切换 |
| `heavy` | `heavyImpact` | `heavyClick` | 重要操作确认（谨慎使用） |
| `success` | `notificationSuccess` | `tick` x2 | 操作成功 |
| `warning` | `notificationWarning` | `longPress` | 警告（极少使用） |
| `selection` | `selectionClick` | `tick` | 选项切换 |

### 2.2 使用规范

**✅ 使用触觉反馈的场景**

| 场景 | 反馈等级 | 说明 |
|------|---------|------|
| 按钮点击 | `medium` | 主要按钮、次要按钮 |
| 开关切换 | `light` | Switch 组件 |
| 列表项选中 | `selection` | Radio、Checkbox |
| Tab 切换 | `selection` | BottomNav、TabBar |
| 下拉刷新触发 | `medium` | 松手触发刷新时 |
| 发布成功 | `success` | "留下"成功 |
| 封存成功 | `success` | 信件封存成功 |
| 删除确认 | `medium` | 确认删除时（非点击删除按钮时） |
| 长按触发 | `medium` | 长按出现菜单时 |

**❌ 不使用触觉反馈的场景**

| 场景 | 原因 |
|------|------|
| 普通滚动 | 过于频繁 |
| 文字输入 | 打断输入流 |
| 页面切换 | 无需额外反馈 |
| 自动操作 | 后台静默 |
| 图片加载完成 | 无需提示 |

### 2.3 实现代码

```dart
import 'package:flutter/services.dart';

class HapticUtils {
  /// 轻触反馈
  static void light() {
    HapticFeedback.lightImpact();
  }
  
  /// 中等反馈（按钮点击）
  static void medium() {
    HapticFeedback.mediumImpact();
  }
  
  /// 成功反馈
  static void success() {
    HapticFeedback.mediumImpact();
    Future.delayed(const Duration(milliseconds: 100), () {
      HapticFeedback.lightImpact();
    });
  }
  
  /// 选择反馈
  static void selection() {
    HapticFeedback.selectionClick();
  }
}
```

### 2.4 无障碍考虑

- 触觉反馈不应是唯一的反馈形式
- 必须配合视觉反馈
- 允许用户在系统设置中关闭

---

## 三、视觉反馈

### 3.1 即时反馈（按下态）

**按钮按下**

```dart
duration: 100ms
animation: scale(1.0 → 0.95)
color: 背景色加深 5%
```

**卡片按下**

```dart
duration: 100ms
animation: scale(1.0 → 0.98)
shadow: 阴影减弱
```

**列表项按下**

```dart
duration: 100ms
animation: backgroundColor → warmGray100
// 不使用缩放，避免布局抖动
```

**图标按钮按下**

```dart
duration: 100ms
animation: opacity(1.0 → 0.6)
```

### 3.2 状态变化反馈

**开关切换**

```dart
duration: 150ms
animation: 
  - 滑块位移
  - 背景色渐变（warmGray300 → primary）
  - 滑块颜色渐变
```

**选中状态**

```dart
duration: 200ms
animation:
  - 边框颜色变化
  - 选中标记渐显（如勾选图标）
  - 可选：背景色轻微变化
```

**收藏/共鸣**

```dart
duration: 300ms
animation:
  - 图标缩放（1.0 → 1.2 → 1.0）
  - 颜色渐变（warmGray400 → heartMedium）
  - 可选：粒子效果（克制的）
```

### 3.3 进度反馈

**线性进度条**

```dart
height: 2-4px
color: primary
backgroundColor: warmGray200
animation: 宽度平滑增长
```

**环形进度**

```dart
strokeWidth: 3px
color: primary
backgroundColor: warmGray200
animation: 顺时针填充
```

**不确定进度（加载中）**

```dart
type: 呼吸点或柔和旋转
color: warmGray400
duration: 1500ms（完成一个周期）
// 避免过快旋转，保持安静感
```

---

## 四、Toast 提示规范

### 4.1 Toast 类型

| 类型 | 图标 | 背景色 | 时长 | 用途 |
|------|------|--------|------|------|
| `success` | ✓ | warmGray800 | 2s | 操作成功 |
| `info` | ℹ️ | warmGray800 | 3s | 信息提示 |
| `warning` | ⚠️ | warmGray800 | 4s | 警告（少用） |
| `error` | ✗ | warmGray800 | 4s | 错误提示 |

**注意**：所有 Toast 使用相同的深色背景，通过图标区分类型，避免使用红色背景。

### 4.2 Toast 文案规范

**成功类**

```
✓ "这一刻，已经被你留住了。"
✓ "已封存"
✓ "已收藏"

✗ "发布成功！"
✗ "操作成功"
```

**信息类**

```
✓ "正在上传..."
✓ "已复制到剪贴板"

✗ "操作进行中"
```

**错误类**

```
✓ "网络不太稳定，请稍后再试"
✓ "内容加载失败"

✗ "Error: Network request failed"
✗ "操作失败！"
```

### 4.3 Toast 位置

| 位置 | 用途 |
|------|------|
| 底部居中 | 默认位置，大多数提示 |
| 顶部居中 | 网络状态提示 |
| 底部偏上（避开 TabBar） | 有底部导航时 |

### 4.4 Toast 交互

```
显示：fadeIn + slideUp(8px)，200ms
消失：fadeOut，150ms
手势：支持滑动关闭
队列：同时最多1个，新的替换旧的
```

### 4.5 实现示例

```dart
class AppSnackbar {
  static void success(BuildContext context, String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Row(
          children: [
            Icon(Icons.check_circle, color: Colors.white, size: 20),
            SizedBox(width: 12),
            Text(message),
          ],
        ),
        behavior: SnackBarBehavior.floating,
        backgroundColor: AppColors.warmGray800,
        duration: Duration(seconds: 2),
        margin: EdgeInsets.only(
          bottom: MediaQuery.of(context).padding.bottom + 60,
          left: 20,
          right: 20,
        ),
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(12),
        ),
      ),
    );
  }
}
```

---

## 五、确认对话框

### 5.1 对话框类型

| 类型 | 用途 | 双按钮 |
|------|------|--------|
| 信息确认 | 告知用户信息 | 单按钮（知道了） |
| 操作确认 | 确认危险操作 | 取消 / 确认 |
| 选择确认 | 让用户做选择 | 选项A / 选项B |

### 5.2 对话框文案

**标题**

```
✓ 简短、清晰
✓ 不超过一行
✓ 不使用问句（大多数情况）

示例：
✓ "确认删除"
✓ "封存这一年"
✗ "你确定要删除吗？"
✗ "警告！！！"
```

**内容**

```
✓ 说明后果
✓ 温和语气
✓ 不超过三行

示例：
✓ "删除后，这条记录将无法恢复。"
✓ "封存后，正文不可修改，但允许追加后记。"
✗ "此操作不可逆！"
```

**按钮**

```
✓ 使用描述性动词
✓ 危险操作放右边（iOS）或左边（强调）

示例：
✓ "取消" / "删除"
✓ "再想想" / "封存"
✗ "否" / "是"
✗ "取消" / "确定"
```

### 5.3 特殊：离开确认

**场景**：用户在编辑内容时尝试离开

```
标题: （无标题，更温和）
内容: "要把这一刻带走，还是留下来？"
按钮: "带走" / "留下来"

或：
内容: "还没有保存，确定离开吗？"
按钮: "离开" / "继续编辑"
```

### 5.4 视觉规范

```
背景: 白色
圆角: 24px
阴影: elevated
遮罩: black @ 40%
宽度: 280-320px
内边距: 24px

标题: 20px / Serif / warmGray900
内容: 15px / Sans / warmGray600 / 行高1.6
按钮: 14px / Sans / 600
```

### 5.5 动效

```
进入: scale(0.9 → 1.0) + fadeIn, 250ms, gentle曲线
遮罩: fadeIn, 200ms
退出: scale(1.0 → 0.95) + fadeOut, 150ms
```

---

## 六、内联反馈

### 6.1 表单验证

**输入时验证（实时）**

```
时机: 用户停止输入 500ms 后
反馈: 输入框下方出现提示文字
动效: fadeIn + slideY, 200ms
颜色: 
  - 错误: dangerDark
  - 成功: successDark（一般不显示）
```

**提交时验证**

```
时机: 点击提交按钮时
反馈: 
  1. 滚动到第一个错误字段
  2. 字段边框变红
  3. 显示错误提示
动效: 边框颜色渐变, 200ms
```

### 6.2 内联状态指示

**同步状态**

```
位置: 页面右上角或 AppBar
图标: 
  - 同步中: 旋转的云图标
  - 同步完成: 勾选的云图标（2秒后消失）
  - 同步失败: 带叹号的云图标（持续显示）
```

**网络状态**

```
位置: 页面顶部（状态栏下方）
样式: 深色条带 + 文字
显示: 无网络时持续显示
文案: "网络不可用，部分功能暂时无法使用"
```

---

## 七、空反馈（无提示场景）

### 7.1 不应该有反馈的操作

| 操作 | 原因 |
|------|------|
| 自动保存 | 后台静默，不打扰 |
| 图片缓存完成 | 无需通知 |
| 数据预加载 | 后台行为 |
| 滚动到底部 | 自然结束 |
| 页面返回 | 无需确认 |

### 7.2 静默失败处理

某些场景下，失败也不需要提示：

```
自动保存失败 → 静默重试，持续失败后才提示
图片加载失败 → 显示占位图，不弹 Toast
```

---

## 八、反馈组合规范

### 8.1 标准操作反馈组合

**轻量操作（收藏、共鸣）**

```
触觉: light
视觉: 图标动画 + 颜色变化
声音: 无
Toast: 无
```

**中量操作（发布"留下"）**

```
触觉: success
视觉: 页面关闭动画 + 卡片出现
声音: 无
Toast: "这一刻，已经被你留住了。"
```

**重量操作（封存信件）**

```
触觉: success
视觉: 仪式动画（纸张下落）
声音: 无（可选：轻柔音效）
Toast: "已封存"
对话框: 封存前确认
```

**危险操作（删除）**

```
触觉: medium（确认时）
视觉: 元素消失动画
声音: 无
Toast: 无（或"已删除，可撤销"）
对话框: 删除前确认
```

---

## 九、反馈自检清单

设计/实现反馈时，对照以下清单：

- [ ] 反馈是否有意义？（不是为了反馈而反馈）
- [ ] 反馈强度是否合适？（不过于强烈）
- [ ] 触觉和视觉是否配合？
- [ ] 文案是否温和、不制造焦虑？
- [ ] 是否考虑了无障碍？
- [ ] 是否避免了连续反馈？

---

> **记住：**
> 好的反馈是"确认"，不是"提醒"。
> 用户应该感到被理解，而不是被打扰。
