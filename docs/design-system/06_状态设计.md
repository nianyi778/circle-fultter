# Aura 拾光 · 状态设计规范

> 状态设计决定了用户在"等待"和"异常"时的体验。
> 在 Aura 中，所有状态都应该是 **温暖的、不焦虑的、有希望的**。

---

## 一、状态设计原则

### 1.1 核心理念

```
温暖的   而不是 冰冷的
有希望的 而不是 绝望的
不责备的 而不是 指责的
耐心的   而不是 催促的
```

### 1.2 状态禁区

| 禁止 | 原因 |
|------|------|
| "暂无数据" | 冰冷、无情感 |
| "加载失败" | 不解释原因 |
| "请检查网络" | 责备用户 |
| 空白页面 | 让用户困惑 |
| 纯技术错误码 | 用户无法理解 |

---

## 二、加载状态

### 2.1 加载状态类型

| 类型 | 用途 | 视觉表现 |
|------|------|---------|
| 骨架屏 | 页面首次加载、内容区域加载 | 灰色占位块 + 呼吸动画 |
| 内联加载 | 按钮提交、小区域刷新 | 小型旋转指示器 |
| 下拉刷新 | 用户主动刷新 | 自定义下拉指示器 |
| 全屏加载 | 重要操作处理中 | 中心加载指示 + 遮罩 |

### 2.2 骨架屏规范

**设计原则**

```
1. 形状匹配：骨架块形状应与实际内容相似
2. 节奏一致：动画节奏保持统一
3. 不要过细：避免过于复杂的骨架结构
4. 柔和动画：使用呼吸/脉冲，不要扫光
```

**视觉规范**

```dart
// 骨架块颜色
背景色: warmGray150
动画色: warmGray200 → warmGray100 → warmGray200

// 骨架块圆角
文字行: 4px
头像: 圆形 (999px)
图片: 8px
卡片: 16px

// 动画
类型: 脉冲（透明度变化）
时长: 1500ms
曲线: breathing
```

**页面骨架屏示例**

```
┌─────────────────────────────────┐
│  ┌───┐  ━━━━━━━━━━━━━━━━━━━━━━  │  ← 顶部导航占位
│  └───┘                          │
├─────────────────────────────────┤
│  ┌─────────────────────────────┐│
│  │ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ ││  ← 大图占位
│  │ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ ││
│  └─────────────────────────────┘│
│  ○ ━━━━━━━━━━ · ━━━━            │  ← 用户信息占位
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │  ← 文字占位
│  ━━━━━━━━━━━━━━━━━━━━           │
└─────────────────────────────────┘
```

**Flutter 实现**

```dart
class SkeletonBox extends StatelessWidget {
  final double width;
  final double height;
  final double borderRadius;

  @override
  Widget build(BuildContext context) {
    return Container(
      width: width,
      height: height,
      decoration: BoxDecoration(
        color: AppColors.warmGray150,
        borderRadius: BorderRadius.circular(borderRadius),
      ),
    ).animate(
      onPlay: (controller) => controller.repeat(),
    ).fadeIn(duration: 750.ms, curve: AppCurves.breathing)
     .fadeOut(duration: 750.ms, curve: AppCurves.breathing);
  }
}
```

### 2.3 各页面骨架屏规范

**首页 (Home)**

```
- 时间数字区：大矩形骨架块
- 卡片区：圆角矩形 + 内部 2-3 行文字骨架
- 加载 1-2 个卡片骨架即可
```

**时间线 (Timeline)**

```
- 列表项骨架：3-5 项
- 每项结构：头像圆形 + 2行文字 + 图片矩形
- 交错延迟：每项延迟 100ms 开始动画
```

**详情页 (Detail)**

```
- 顶部图片：全宽矩形
- 标题：1行长文字骨架
- 正文：3-4行文字骨架
- 底部：小矩形按钮骨架
```

### 2.4 内联加载指示器

**按钮加载态**

```dart
// 按钮文字替换为加载指示器
按钮宽度: 保持不变（避免布局跳动）
指示器大小: 20px
指示器颜色: 与按钮文字同色
动画: 平滑旋转, 1000ms/圈
```

**小区域加载**

```dart
指示器大小: 16-24px
颜色: warmGray400
位置: 区域居中
```

### 2.5 下拉刷新

**视觉规范**

```dart
触发距离: 80px
指示器样式: 自定义（非 Material 默认）
颜色: warmGray500
背景: 透明或极浅背景
动画: 
  - 下拉时：箭头旋转
  - 刷新中：平滑旋转
  - 完成时：勾选图标 + 收起
```

**文案**

```
下拉中: 无文案（或"下拉刷新"）
释放时: 无文案（或"松开刷新"）
刷新中: 无文案
完成时: 无文案（静默完成）
```

### 2.6 全屏加载

**使用场景**

```
- 重要操作提交中（如封存信件）
- 大文件上传中
- 需要阻止用户其他操作时
```

**视觉规范**

```dart
遮罩: black @ 30%
指示器: 居中, 32px
可选文案: 居中, 指示器下方 16px
文案样式: 14px / warmGray100
动画: fadeIn, 200ms
```

**文案示例**

```
✓ "正在上传..."
✓ "正在封存..."
✓ 无文案（简洁）

✗ "请稍候..."
✗ "Loading..."
```

---

## 三、空状态

### 3.1 空状态类型

| 类型 | 场景 | 情绪基调 |
|------|------|---------|
| 初始空状态 | 用户首次使用，无内容 | 欢迎、期待 |
| 结果空状态 | 搜索/筛选无结果 | 中性、引导 |
| 清空空状态 | 内容被全部删除 | 平和、不责备 |
| 时间空状态 | 特定时间段无内容 | 温暖、有希望 |

### 3.2 空状态组成

```
┌─────────────────────────────────┐
│                                 │
│            [插图]               │  ← 可选，温和的插图
│                                 │
│         主文案                  │  ← 必须，温暖的描述
│       辅助文案                  │  ← 可选，补充说明
│                                 │
│        [行动按钮]               │  ← 可选，引导操作
│                                 │
└─────────────────────────────────┘
```

### 3.3 空状态文案规范

**首页 - 初始空状态**

```
插图: 时间沙漏或日记本
主文案: "这里会慢慢被时间填满。"
按钮: "留下第一刻"
```

**时间线 - 初始空状态**

```
插图: 时间河流
主文案: "这一条时间线，会慢慢被你填满。"
辅助: 无
按钮: "开始记录"
```

**时间线 - 筛选空状态**

```
插图: 放大镜
主文案: "没有找到匹配的记录"
辅助: "试试调整筛选条件？"
按钮: "清除筛选"
```

**去年的今天 - 无数据**

```
主文案: "去年今天，你还没有记录。"
辅助: "等明年，它会出现的。"
按钮: 无
```

**信列表 - 初始空状态**

```
插图: 羽毛笔
主文案: "还没有写过信"
辅助: "不必很长，一句话也可以。"
按钮: "开始写第一封"
```

**世界频道 - 无内容**

```
主文案: "这个频道还没有内容"
辅助: "也许你可以成为第一个。"
按钮: 无（或"分享一个片段"）
```

**搜索 - 无结果**

```
主文案: "没有找到相关内容"
辅助: 无
按钮: 无
```

### 3.4 空状态视觉规范

**布局**

```dart
位置: 容器垂直居中偏上（视觉重心）
最大宽度: 280px
内边距: 40px

插图大小: 80-120px
插图与文字间距: 24px
主文案与辅助文案间距: 8px
文案与按钮间距: 24px
```

**文字样式**

```dart
主文案:
  - 字号: 16px
  - 字重: 400
  - 颜色: warmGray700
  - 对齐: 居中

辅助文案:
  - 字号: 14px
  - 字重: 400
  - 颜色: warmGray500
  - 对齐: 居中
```

**按钮样式**

```dart
类型: 次要按钮或文字按钮
颜色: primary 或 warmGray600
```

### 3.5 空状态禁用文案

| 禁止使用 | 替代方案 |
|---------|---------|
| "暂无数据" | "这里会慢慢填满" |
| "空空如也" | "还没有内容" |
| "快去添加吧！" | "可以在这里记录" |
| "什么都没有" | "等待第一个..." |

---

## 四、错误状态

### 4.1 错误状态类型

| 类型 | 场景 | 严重程度 |
|------|------|---------|
| 网络错误 | 无网络连接 | 中 |
| 加载错误 | 内容加载失败 | 中 |
| 提交错误 | 操作未能完成 | 中 |
| 表单错误 | 输入验证失败 | 低 |
| 权限错误 | 无访问权限 | 高 |
| 系统错误 | 未知错误 | 高 |

### 4.2 错误提示方式

| 错误类型 | 提示方式 |
|---------|---------|
| 表单验证 | 内联提示（字段下方） |
| 操作失败 | Toast 提示 |
| 页面加载失败 | 页面级错误状态 |
| 网络断开 | 顶部条幅提示 |
| 系统故障 | 全屏错误页 |

### 4.3 错误文案规范

**网络错误**

```
Toast: "网络不太稳定，请稍后再试"
页面级: 
  主文案: "网络好像断开了"
  辅助: "检查网络后，可以点击重试"
  按钮: "重试"
```

**加载错误**

```
Toast: "内容加载失败，请重试"
页面级:
  主文案: "内容加载失败"
  辅助: "可能是网络问题，请稍后再试"
  按钮: "重试"
```

**提交错误**

```
Toast: "保存失败，请重试"
对话框: 
  标题: "保存失败"
  内容: "可能是网络问题，您的内容已自动保存在本地。"
  按钮: "知道了"
```

**表单验证错误**

```
内联提示:
  - "请输入内容"
  - "内容过长"
  - "格式不正确"
```

**权限错误**

```
页面级:
  主文案: "没有访问权限"
  辅助: "您可能需要登录或获取邀请"
  按钮: "返回"
```

### 4.4 错误状态视觉规范

**内联错误（表单）**

```dart
边框颜色: dangerMedium
提示文字颜色: dangerDark
提示文字大小: 12px
提示文字位置: 输入框下方 4px
动效: fadeIn, 200ms
```

**Toast 错误**

```dart
背景: warmGray800（与成功一致）
图标: ✗ 或 ⚠️
时长: 4s（比成功长）
```

**页面级错误**

```dart
布局: 与空状态相同
图标: 温和的错误图标（不用红色警告三角）
主文案颜色: warmGray700（不用红色）
按钮: 主要按钮 "重试"
```

### 4.5 错误恢复机制

**自动重试**

```
网络请求失败: 自动重试 1-2 次
重试间隔: 1s, 2s（指数退避）
超过重试次数: 显示错误，提供手动重试
```

**保留用户输入**

```
表单提交失败: 保留所有已输入内容
页面刷新失败: 不清空当前内容
网络恢复后: 自动重新提交（可选）
```

---

## 五、禁用状态

### 5.1 禁用状态场景

| 场景 | 说明 |
|------|------|
| 条件未满足 | 必填项未填写 |
| 操作进行中 | 正在提交 |
| 权限不足 | 无操作权限 |
| 时间限制 | 未到可操作时间 |

### 5.2 禁用状态视觉

**按钮禁用**

```dart
背景色: warmGray200
文字色: warmGray400
边框: 无
阴影: 无
cursor: not-allowed（Web）
透明度: 不使用透明度（保持清晰）
```

**输入框禁用**

```dart
背景色: warmGray100
边框色: warmGray200
文字色: warmGray400
placeholder: warmGray300
```

**开关禁用**

```dart
轨道色: warmGray200
滑块色: warmGray300
```

### 5.3 禁用状态交互

```
点击: 无反馈（不响应）
hover: 无变化（Web）
不应该: 弹出 Toast 解释原因（除非必要）
```

---

## 六、成功状态

### 6.1 成功状态类型

| 类型 | 场景 | 反馈方式 |
|------|------|---------|
| 轻量成功 | 收藏、共鸣 | 视觉变化 + 触觉 |
| 标准成功 | 发布、保存 | Toast |
| 仪式成功 | 封存信件 | 动画 + Toast |

### 6.2 成功状态反馈

**参见 05_反馈系统.md**

---

## 七、网络状态指示

### 7.1 离线状态

**顶部条幅**

```dart
位置: 状态栏下方
高度: 28px
背景: warmGray700
文字: "网络不可用" / 12px / warmGray100
动效: slideDown + fadeIn, 200ms
消失: 网络恢复后 1s 自动消失
```

### 7.2 弱网状态

**行为调整**

```
图片: 降低质量或显示占位
视频: 显示封面，不自动播放
上传: 显示进度，允许后台继续
请求: 增加超时时间
```

### 7.3 同步状态指示

**位置**: AppBar 右侧或标题下方

**状态图标**

```
同步中: 旋转的同步图标 / warmGray400
同步完成: 勾选图标 / successMedium / 2秒后消失
同步失败: 感叹号图标 / warningMedium / 持续显示
```

---

## 八、状态转换

### 8.1 加载 → 成功

```dart
骨架屏 → 实际内容
动效: 
  - 骨架块 fadeOut, 200ms
  - 内容 fadeIn + 轻微 slideUp, 300ms
  - 交错进入各元素
```

### 8.2 加载 → 错误

```dart
骨架屏 → 错误状态
动效:
  - 骨架块 fadeOut, 200ms
  - 错误状态 fadeIn, 300ms
```

### 8.3 加载 → 空

```dart
骨架屏 → 空状态
动效:
  - 骨架块 fadeOut, 200ms
  - 空状态 fadeIn, 400ms（稍慢，让用户注意）
```

### 8.4 错误 → 加载（重试）

```dart
点击重试 → 显示加载 → 等待结果
动效:
  - 重试按钮 loading 态
  - 错误内容保持（不闪烁）
  - 成功后: 错误状态 fadeOut → 内容 fadeIn
  - 失败后: 按钮恢复, Toast 提示
```

---

## 九、状态设计自检清单

- [ ] 加载状态是否有骨架屏或指示器？
- [ ] 空状态文案是否温暖、不责备？
- [ ] 错误状态是否提供了恢复方式？
- [ ] 状态转换是否平滑、不突兀？
- [ ] 禁用状态视觉是否清晰？
- [ ] 网络状态是否有适当提示？
- [ ] 是否避免了"暂无数据"等冷漠文案？

---

> **记住：**
> 状态不是异常，而是体验的一部分。
> 让用户在任何状态下都感到被照顾。
