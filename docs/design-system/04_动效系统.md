# Aura 拾光 · 动效系统

> 动效不是装饰，而是产品情绪的一部分。
> 在 Aura 中，动效的核心原则是：**慢一点、轻一点、永远不打断情绪**。

---

## 一、动效设计原则

### 1.1 核心理念

```
克制的   而不是 华丽的
缓慢的   而不是 敏捷的
自然的   而不是 机械的
有意义的 而不是 随意的
```

### 1.2 动效禁区

| 禁止使用 | 原因 |
|---------|------|
| 弹跳动画 (bouncy) | 过于活跃，破坏安静感 |
| 抖动动画 (shake) | 制造焦虑，带有警告意味 |
| 闪烁动画 (blink) | 制造紧迫感 |
| 过快动画 (<150ms) | 显得急促、不够庄重 |
| 持续循环动画 | 分散注意力（呼吸动画除外） |

### 1.3 何时使用动效

| 场景 | 是否使用 | 说明 |
|------|---------|------|
| 页面切换 | ✅ 必须 | 建立空间感 |
| 元素入场 | ✅ 推荐 | 引导注意力 |
| 状态变化 | ✅ 推荐 | 反馈用户操作 |
| 持续吸引注意 | ⚠️ 谨慎 | 仅用于关键提示 |
| 纯装饰目的 | ❌ 禁止 | 无意义的动效 |

---

## 二、时长系统 (Duration)

### 2.1 标准时长

| 名称 | 时长 | 用途 | Dart 常量 |
|------|------|------|-----------|
| `instant` | 100ms | 瞬间反馈（按下效果） | `AppDurations.instant` |
| `fast` | 150ms | 快速交互（开关切换） | `AppDurations.fast` |
| `normal` | 250ms | 标准动画（大多数场景） | `AppDurations.normal` |
| `pageTransition` | 300ms | 页面切换 | `AppDurations.pageTransition` |
| `slow` | 400ms | 缓慢出现（重要内容） | `AppDurations.slow` |
| `ceremony` | 600ms | 仪式动画（封存、发布） | `AppDurations.ceremony` |
| `entrance` | 800ms | 页面入场（首次加载） | `AppDurations.entrance` |
| `breathing` | 2000ms | 呼吸循环 | `AppDurations.breathing` |

### 2.2 时长选择指南

```
操作反馈（点击、切换）     → instant / fast    (100-150ms)
状态变化（展开、收起）     → normal            (250ms)
页面切换                   → pageTransition    (300ms)
内容入场                   → slow              (400ms)
重要仪式（封存、发布）     → ceremony          (600ms)
首次入场（启动页）         → entrance          (800ms)
```

### 2.3 原则：宁慢勿快

> 在 Aura 中，如果不确定用哪个时长，选择更慢的那个。

---

## 三、曲线系统 (Curves)

### 3.1 标准曲线

| 名称 | 曲线定义 | 用途 | Dart 常量 |
|------|---------|------|-----------|
| `standard` | `easeOutCubic` | 默认缓动（通用） | `AppCurves.standard` |
| `enter` | `Cubic(0.0, 0.0, 0.2, 1.0)` | 进入动画（柔和开始） | `AppCurves.enter` |
| `exit` | `Cubic(0.4, 0.0, 1.0, 1.0)` | 退出动画（快速离开） | `AppCurves.exit` |
| `breathing` | `Cubic(0.4, 0.0, 0.6, 1.0)` | 呼吸循环 | `AppCurves.breathing` |
| `gentle` | `Cubic(0.34, 1.56, 0.64, 1.0)` | 柔和弹性（克制的弹跳） | `AppCurves.gentle` |
| `smooth` | `easeInOutCubic` | 缓入缓出 | `AppCurves.smooth` |

### 3.2 曲线选择指南

```
元素进入画面           → enter      (柔和开始，自然结束)
元素离开画面           → exit       (快速开始，自然结束)
状态切换               → standard   (通用缓动)
呼吸/循环动画          → breathing  (平滑往复)
需要轻微弹性           → gentle     (克制的弹跳，不夸张)
对称动画               → smooth     (进出对称)
```

### 3.3 禁用曲线

| 曲线 | 原因 |
|------|------|
| `bounceIn/Out` | 过于活跃 |
| `elasticIn/Out` | 过于夸张 |
| `linear` | 过于机械 |

---

## 四、入场动画规范

### 4.1 页面入场

**整页入场（从其他页面跳转）**

```dart
// 推荐：柔和上滑 + 渐显
duration: 300ms
curve: AppCurves.enter
animation: slideUp(16px) + fadeIn
```

**模态入场（底部弹起）**

```dart
// 如：发布页、详情页
duration: 300ms
curve: AppCurves.enter
animation: slideUp(从屏幕底部) + fadeIn
background: 半透明遮罩同步渐显
```

### 4.2 列表入场

**列表项交错入场**

```dart
// 每项延迟 60-80ms
baseDelay: 60ms
duration: 400ms
curve: AppCurves.enter
animation: slideX(3%) + fadeIn
maxItems: 5  // 超过5项后不再延迟增加
```

**示例代码：**

```dart
ListView.builder(
  itemBuilder: (context, index) {
    return widget
      .animate(delay: Duration(milliseconds: 60 * min(index, 5)))
      .fadeIn(duration: 400.ms, curve: AppCurves.enter)
      .slideX(begin: 0.03, curve: AppCurves.enter);
  },
)
```

### 4.3 卡片入场

**单卡片入场**

```dart
duration: 600ms
curve: AppCurves.enter
animation: scale(0.97 → 1.0) + fadeIn
```

**卡片组入场**

```dart
// 卡片之间延迟 100ms
baseDelay: 100ms
duration: 600ms
animation: scale(0.97 → 1.0) + fadeIn
```

### 4.4 元素渐显

**标题/文字渐显**

```dart
duration: 400ms
curve: AppCurves.enter
animation: fadeIn + slideY(4%)
```

**图标/小元素渐显**

```dart
duration: 300ms
curve: AppCurves.standard
animation: fadeIn
```

---

## 五、交互动效规范

### 5.1 点击反馈

**按钮点击**

```dart
duration: 100ms
animation: scale(1.0 → 0.95 → 1.0)
curve: AppCurves.standard
```

**卡片点击**

```dart
duration: 100ms
animation: scale(1.0 → 0.98 → 1.0)
// 卡片缩放幅度比按钮小
```

**列表项点击**

```dart
duration: 100ms
animation: backgroundColor 变化（微妙变暗）
// 不使用缩放，避免布局抖动
```

### 5.2 开关切换

```dart
duration: 150ms
curve: AppCurves.standard
animation: 滑块位移 + 背景色渐变
```

### 5.3 展开/收起

**折叠内容展开**

```dart
duration: 250ms
curve: AppCurves.standard
animation: height 变化 + 内容 fadeIn
```

**下拉菜单展开**

```dart
duration: 200ms
curve: AppCurves.enter
animation: scaleY + fadeIn
transformOrigin: 顶部
```

### 5.4 删除/消失

```dart
duration: 200ms
curve: AppCurves.exit
animation: slideX(-100%) + fadeOut
// 或: scale(1.0 → 0.9) + fadeOut
```

---

## 六、页面转场规范

### 6.1 标准页面切换

**向前导航（进入新页面）**

```dart
// 新页面
duration: 300ms
animation: slideUp(5%) + fadeIn
curve: AppCurves.enter

// 当前页面
animation: 无变化或轻微 scale down
```

**向后导航（返回）**

```dart
// 返回的页面
duration: 250ms
animation: fadeIn
curve: AppCurves.standard

// 离开的页面
animation: slideDown(5%) + fadeOut
curve: AppCurves.exit
```

### 6.2 模态页面

**底部弹起模态（发布页、详情页）**

```dart
duration: 300ms
curve: AppCurves.enter
animation: slideUp(从底部) + fadeIn
background: black @ 30% 同步渐显
dismissible: 下滑关闭
```

**中心弹出模态（确认框）**

```dart
duration: 250ms
curve: AppCurves.gentle  // 轻微弹性
animation: scale(0.9 → 1.0) + fadeIn
background: black @ 40% 同步渐显
```

### 6.3 Tab 切换

```dart
duration: 200ms
curve: AppCurves.standard
animation: fadeIn（新 Tab 内容）
// 不使用滑动，避免方向感混乱
```

---

## 七、特殊动效

### 7.1 呼吸动效

**用途**：轻柔吸引注意力（如：提示写年度信）

```dart
duration: 2000ms
curve: AppCurves.breathing
animation: scale(1.0 → 0.96 → 1.0)
repeat: infinite
```

**注意**：呼吸动效应极其克制，整个页面最多1处

### 7.2 脉冲动效

**用途**：比呼吸更微妙的提示

```dart
duration: 2000ms
curve: AppCurves.breathing
animation: opacity(1.0 → 0.7 → 1.0)
repeat: infinite
```

### 7.3 数字滚动

**用途**：首页天数显示

```dart
duration: 800ms
curve: AppCurves.smooth
animation: 数字从 0 滚动到目标值
// 仅首次进入时播放，切回不重复
```

### 7.4 纸张质感

**用途**：信封存时的下落感

```dart
duration: 600ms
curve: AppCurves.gentle
animation: translateY(0 → 20px) + scale(1.0 → 0.95) + fadeOut
```

---

## 八、动效分级

### 8.1 分级标准

| 等级 | 描述 | 适用场景 | 是否可关闭 |
|------|------|---------|-----------|
| L1 必要 | 功能性动效，关闭会影响可用性 | 页面切换、状态反馈 | 否 |
| L2 推荐 | 增强体验，但非必需 | 入场动画、交互反馈 | 系统设置跟随 |
| L3 装饰 | 纯粹美化 | 呼吸动效 | 可关闭 |

### 8.2 无障碍适配

**减弱动效模式**

当系统开启"减弱动效"时：

```dart
if (MediaQuery.of(context).disableAnimations) {
  // L2、L3 动效禁用
  // L1 动效时长减半，曲线改为 linear
}
```

**具体处理：**

| 动效类型 | 正常模式 | 减弱模式 |
|---------|---------|---------|
| 页面切换 | 300ms + 滑动 | 150ms + 仅渐变 |
| 入场动画 | 400ms | 禁用 |
| 交互反馈 | 100ms | 保留 |
| 呼吸动效 | 正常 | 禁用 |

---

## 九、实现指南

### 9.1 使用 flutter_animate

**推荐方式**

```dart
// 入场动画
widget
  .animate()
  .fadeIn(duration: 400.ms, curve: AppCurves.enter)
  .slideY(begin: 0.04, curve: AppCurves.enter);

// 交错入场
widget
  .animate(delay: Duration(milliseconds: 60 * index))
  .fadeIn(duration: 400.ms)
  .slideX(begin: 0.03);
```

### 9.2 使用 AnimationUtils

```dart
// 呼吸动效
AnimationUtils.breathe(child: widget);

// 点击缩放
AnimationUtils.tapScale(
  child: button,
  onTap: () {},
);

// 列表项入场
AnimationUtils.staggered(
  index: index,
  child: listItem,
);
```

### 9.3 自定义页面转场

```dart
// 在 GoRouter 中使用
GoRoute(
  path: '/detail',
  pageBuilder: (context, state) {
    return AuraPageTransition.slideUp(
      child: DetailPage(),
    );
  },
)
```

---

## 十、动效自检清单

设计/实现动效时，对照以下清单：

- [ ] 时长是否足够慢？（不低于 150ms）
- [ ] 曲线是否自然？（禁用 bounce/elastic）
- [ ] 是否有明确意义？（不是纯装饰）
- [ ] 是否会打断情绪？
- [ ] 减弱动效模式下是否正常？
- [ ] 是否符合分级规范？

---

> **记住：**
> 好的动效让人感觉不到"动"，
> 只感觉到"自然"。
