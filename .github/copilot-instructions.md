# TimeCircle - AI Coding Instructions

## ğŸš¨ å¼€å‘å·¥ä½œæµç¨‹ï¼ˆå¿…é¡»éµå®ˆï¼‰

### 1. éœ€æ±‚ç¡®è®¤é˜¶æ®µ
- **å¼€å§‹ä»»ä½•éœ€æ±‚/bug å‰ï¼Œå¿…é¡»å…ˆç¡®è®¤éœ€æ±‚ç»†èŠ‚**
- ä¸ç†è§£çš„åœ°æ–¹ **å¿…é¡»ä¸å¼€å‘è€…ç¡®è®¤**ï¼Œç¦æ­¢å‡è®¾
- ç¡®è®¤å®Œæ¯•åï¼Œå°†éœ€æ±‚æ–‡æ¡£å†™å…¥ `prd/xxx.md`

### 2. æŠ€æœ¯æ–¹æ¡ˆé˜¶æ®µ
- æŠ€æœ¯å®ç°æ–¹æ¡ˆå†™å…¥ `docs/YYYY_MM_DD_xxx.md`ï¼ˆå¦‚ `docs/2026_01_21_ä¿¡ä»¶ç¼–è¾‘é¡µé‡æ„.md`ï¼‰
- æ–¹æ¡ˆéœ€åŒ…å«ï¼š
  - éœ€æ±‚èƒŒæ™¯
  - æŠ€æœ¯æ–¹æ¡ˆ
  - å½±å“èŒƒå›´
  - **æµ‹è¯•ç”¨ä¾‹**ï¼ˆå¿…é¡»è¯¦ç»†ï¼Œä¾›ç”¨æˆ·æ‰‹åŠ¨éªŒæ”¶ï¼‰

### 3. ä»£ç å®ç°é˜¶æ®µ
- æ¶æ„éµå¾ªæœ€ä½³å®è·µï¼Œæ³¨é‡æ€§èƒ½
- **ç¦æ­¢å¼•å…¥ bug**ï¼Œä»£ç å¿…é¡»å®Œç¾
- æ¶‰åŠä»¥ä¸‹å˜æ›´æ—¶ï¼Œå¿…é¡»åŒæ­¥æ›´æ–° `codebase/xxx.md`ï¼š
  - æ¶æ„å˜åŒ–
  - ç›®å½•ç»“æ„å˜åŠ¨
  - å…¬å…±ç»„ä»¶/å‡½æ•°æ–°å¢æˆ–ä¿®æ”¹

### 4. éªŒè¯é˜¶æ®µ
- ä»£ç å†™å®Œå **å¿…é¡»è¿è¡Œ `flutter analyze`** ç¡®ä¿æ— é”™è¯¯
- å°è¯•ç¼–è¯‘ç¡®ä¿æ— è¿è¡Œæ—¶é—®é¢˜
- å®Œå–„æµ‹è¯•ç”¨ä¾‹

### 5. éªŒæ”¶é˜¶æ®µ
- å°†æµ‹è¯•ç”¨ä¾‹æä¾›ç»™ç”¨æˆ·
- ç”¨æˆ·æ‰‹åŠ¨æµ‹è¯•
- **å¿…é¡»ç­‰å¾…ç”¨æˆ·æ˜ç¡®å›å¤ã€ŒéªŒæ”¶é€šè¿‡ã€æ‰ç®—å®Œæˆ**
- éªŒæ”¶é€šè¿‡åï¼Œæ›´æ–°ç›¸å…³æ–‡æ¡£é—­ç¯

### ğŸ“ æ–‡æ¡£å‘½åè§„èŒƒï¼ˆä¸‰æ–‡æ¡£å…³è”ï¼‰

ä½¿ç”¨ **ç»Ÿä¸€åŠŸèƒ½ ID** å…³è”ä¸‰ç±»æ–‡æ¡£ï¼š

| ç›®å½• | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|------|----------|------|
| `prd/` | `YYYY_MM_DD_åŠŸèƒ½ID_éœ€æ±‚å.md` | `2026_01_21_letter_edit_ä¿¡ä»¶ç¼–è¾‘é¡µ.md` |
| `docs/` | `YYYY_MM_DD_åŠŸèƒ½ID_æŠ€æœ¯æ–¹æ¡ˆ.md` | `2026_01_21_letter_edit_æŠ€æœ¯æ–¹æ¡ˆ.md` |
| `codebase/` | `åŠŸèƒ½ID_æ¨¡å—è¯´æ˜.md` | `letter_edit_å…¬å…±ç»„ä»¶.md` |

**åŠŸèƒ½ ID å‘½åè§„åˆ™**ï¼š
- ä½¿ç”¨å°å†™è‹±æ–‡ + ä¸‹åˆ’çº¿
- ç®€çŸ­æ˜“è¯†åˆ«ï¼ˆå¦‚ `letter_edit`, `moment_detail`, `home_memory`ï¼‰
- åŒä¸€åŠŸèƒ½çš„ä¸‰ä¸ªæ–‡æ¡£ä½¿ç”¨ **ç›¸åŒçš„åŠŸèƒ½ ID**

**æ–‡æ¡£å¤´éƒ¨å…³è”å£°æ˜**ï¼ˆæ¯ä¸ªæ–‡æ¡£å¼€å¤´æ·»åŠ ï¼‰ï¼š
```markdown
---
åŠŸèƒ½ID: letter_edit
éœ€æ±‚æ–‡æ¡£: prd/2026_01_21_letter_edit_ä¿¡ä»¶ç¼–è¾‘é¡µ.md
æŠ€æœ¯æ–¹æ¡ˆ: docs/2026_01_21_letter_edit_æŠ€æœ¯æ–¹æ¡ˆ.md
ä»£ç æ–‡æ¡£: codebase/letter_edit_å…¬å…±ç»„ä»¶.md
---
```

**ç›®å½•ç»“æ„**ï¼š
```
prd/              # éœ€æ±‚æ–‡æ¡£ï¼ˆäº§å“è§†è§’ï¼‰
docs/             # æŠ€æœ¯æ–¹æ¡ˆ + è®¾è®¡è§„èŒƒï¼ˆå¼€å‘è§†è§’ï¼‰
codebase/         # æ¶æ„/å…¬å…±ç»„ä»¶/å‡½æ•°æ–‡æ¡£ï¼ˆä»£ç è§†è§’ï¼ŒæŒç»­æ›´æ–°ï¼‰
```

---

## é¡¹ç›®æ¦‚è¿°

TimeCircleï¼ˆå®¶åº­å›å¿†æ—¶é—´èƒ¶å›Šï¼‰æ˜¯ä¸€ä¸ª Flutter åº”ç”¨ï¼Œç”¨äºè®°å½•å®¶åº­æˆé•¿å›å¿†ã€‚è¿™æ˜¯ä¸€ä¸ª **æƒ…æ„Ÿä½“éªŒäº§å“**ï¼Œä¸æ˜¯æ•ˆç‡å·¥å…·ã€‚

è®¾è®¡è§„èŒƒè¯¦è§ [docs/time_circle_è®¾è®¡è§„èŒƒ_home_é¦–é¡µè®¾è®¡ï¼ˆè®¾è®¡åŸºå‡†ç¨¿ï¼‰.md](../docs/time_circle_è®¾è®¡è§„èŒƒ_home_é¦–é¡µè®¾è®¡ï¼ˆè®¾è®¡åŸºå‡†ç¨¿ï¼‰.md)

## æ¶æ„æ¨¡å¼

```
lib/
â”œâ”€â”€ core/              # æ ¸å¿ƒå±‚ï¼štheme, models, providers, router
â”œâ”€â”€ features/          # åŠŸèƒ½æ¨¡å—ï¼šhome, timeline, letters, world, create, settings
â”‚   â””â”€â”€ {feature}/
â”‚       â”œâ”€â”€ views/     # é¡µé¢è§†å›¾
â”‚       â””â”€â”€ widgets/   # åŠŸèƒ½ç§æœ‰ç»„ä»¶
â”œâ”€â”€ shared/widgets/    # è·¨åŠŸèƒ½å…±äº«ç»„ä»¶
â””â”€â”€ main.dart
```

### å…³é”®æ¶æ„å†³ç­–

1. **çŠ¶æ€ç®¡ç†**: `flutter_riverpod` - æ‰€æœ‰ Provider å®šä¹‰åœ¨ `lib/core/providers/app_providers.dart`
2. **è·¯ç”±**: `go_router` + `ShellRoute` - ä¸» Tab é¡µé¢å…±äº« `MainScaffold`ï¼Œè¯¦æƒ…é¡µç‹¬ç«‹æ— åº•éƒ¨å¯¼èˆª
3. **ç»„ä»¶å¤ç”¨**: è¯¦æƒ…é¡µå…±äº«ç»„ä»¶ä½äº `lib/shared/widgets/`ï¼ˆMediaViewer, DetailActionBar, ContextTagsView ç­‰ï¼‰

## è®¾è®¡ç³»ç»Ÿï¼ˆå¿…è¯»ï¼‰

### è‰²å½©ï¼ˆAppColorsï¼‰
```dart
timeBeige: #FAF9F7      // å…¨å±€èƒŒæ™¯ï¼ˆåƒæ—§çº¸å¼ ï¼‰
warmGray900-100         // æ–‡å­—ç°åº¦ç³»åˆ—
calmBlue, warmPeach, softGreen, mutedViolet  // æƒ…ç»ªè¾…åŠ©è‰²ï¼ˆä½é¥±å’Œï¼Œä»…ç‚¹ç¼€ï¼‰
```

### åŠ¨æ•ˆï¼ˆAppDurationsï¼‰
```dart
fast: 150ms      // å¿«é€Ÿäº¤äº’
normal: 250ms    // æ ‡å‡†åŠ¨ç”»
slow: 400ms      // ç¼“æ…¢å‡ºç°
ceremony: 600ms  // ä»ªå¼åŠ¨ç”»ï¼ˆå¦‚å°å­˜ï¼‰
```

**ä¸¥ç¦**: å¼¹è·³ã€æŠ–åŠ¨ã€å¼ºåé¦ˆåŠ¨ç”»ã€‚æ°¸è¿œ **æ…¢ä¸€ç‚¹ã€è½»ä¸€ç‚¹ã€ä¸æ‰“æ–­æƒ…ç»ª**ã€‚

### åè®¾è®¡æ¸…å•ï¼ˆä¸¥ç¦ï¼‰
- âŒ é«˜é¥±å’Œè‰² / å¼ºå¯¹æ¯”
- âŒ å·¥å…·æ„Ÿ UIï¼ˆè¡¨æ ¼ / å¼ºè¾¹æ¡†ï¼‰
- âŒ ä¿¡æ¯å¯†åº¦è¿‡é«˜
- âŒ çº¢ç‚¹è½°ç‚¸

## ä»£ç çº¦å®š

### åŠ¨ç”»ä½¿ç”¨
```dart
// âœ… æ­£ç¡®: åœ¨æ™®é€š Widget ä¸Šä½¿ç”¨ flutter_animate
Widget().animate().fadeIn(duration: 400.ms)

// âŒ é”™è¯¯: åœ¨ Sliver ä¸Šç›´æ¥è°ƒç”¨ animate()
SliverToBoxAdapter(...).animate()  // ä¼šæŠ¥é”™

// âœ… Sliver ä¸­çš„åŠ¨ç”»åº”ç”¨åœ¨ child ä¸Š
SliverToBoxAdapter(
  child: Widget().animate().fadeIn(),
)
```

### Provider å‘½å
```dart
// ç®€å•çŠ¶æ€
final xxxProvider = Provider<Type>((ref) => ...);
// å¯å˜çŠ¶æ€
final xxxProvider = StateNotifierProvider<XxxNotifier, Type>((ref) => ...);
// æŒ‰ ID æŸ¥è¯¢
final xxxByIdProvider = Provider.family<Type?, String>((ref, id) => ...);
```

### è·¯ç”±è·³è½¬
```dart
context.push('/moment/${moment.id}');  // è¯¦æƒ…é¡µ
context.go('/timeline');                // Tab é¡µåˆ‡æ¢
```

## å¸¸ç”¨å‘½ä»¤

```bash
cd time_circle_flutter
flutter analyze         # ä»£ç æ£€æŸ¥ï¼ˆæ¯æ¬¡å¿…é¡»è¿è¡Œï¼‰
flutter test            # è¿è¡Œæµ‹è¯•
flutter run -d emulator-5554  # è¿è¡Œåˆ° Android æ¨¡æ‹Ÿå™¨
flutter run -d macos    # macOS æ¡Œé¢ï¼ˆéœ€å…ˆé…ç½®ç½‘ç»œæƒé™ï¼‰
```

### ä»£ç è´¨é‡æ£€æŸ¥æ¸…å•
- [ ] `flutter analyze` æ— é”™è¯¯ã€æ— è­¦å‘Š
- [ ] ç¼–è¯‘é€šè¿‡ï¼Œæ— è¿è¡Œæ—¶å¼‚å¸¸
- [ ] æ–°å¢ä»£ç æœ‰å¯¹åº”æµ‹è¯•ç”¨ä¾‹
- [ ] å…¬å…±ç»„ä»¶/å‡½æ•°å·²æ›´æ–° `codebase/` æ–‡æ¡£
- [ ] æŠ€æœ¯æ–¹æ¡ˆå·²å†™å…¥ `docs/YYYY_MM_DD_xxx.md`

### macOS ç½‘ç»œæƒé™
å¦‚éœ€åœ¨ macOS ä¸ŠåŠ è½½ç½‘ç»œå›¾ç‰‡/å­—ä½“ï¼Œç¡®ä¿ `macos/Runner/DebugProfile.entitlements` åŒ…å«ï¼š
```xml
<key>com.apple.security.network.client</key>
<true/>
```

## æ¨¡å‹ç»“æ„

| æ¨¡å‹ | ç”¨é€” | å…³é”®å­—æ®µ |
|------|------|----------|
| `Moment` | æ—¶åˆ»/è®°å½• | mediaType, contextTags, futureMessage |
| `Letter` | å¹´åº¦ä¿¡/éšè®° | status (draft/sealed/opened), type |
| `User` | ç”¨æˆ· | role (dad/mom/grandpa/grandma) |
| `ContextTag` | è¯­å¢ƒæ ‡ç­¾ | type (parentMood/childState), emoji |

## å…±äº«ç»„ä»¶ï¼ˆä¼˜å…ˆå¤ç”¨ï¼‰

- `MediaViewer`: å›¾ç‰‡/è§†é¢‘/éŸ³é¢‘ç»Ÿä¸€å±•ç¤º
- `ContextTagsView`: è¯­å¢ƒæ ‡ç­¾å±•ç¤º
- `FutureMessageCard`: "å¯¹æœªæ¥è¯´ä¸€å¥"å¡ç‰‡
- `DetailActionBar`: åº•éƒ¨æ“ä½œæ ï¼ˆå…±é¸£/æ”¶è—/æ›´å¤šï¼‰
- `DetailAppBar`: è¯¦æƒ…é¡µç»Ÿä¸€å¯¼èˆªæ 
